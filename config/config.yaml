# -----------------------------------------------------------------------------
# RangePlotter Configuration
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# Main user settings
# -----------------------------------------------------------------------------

# Default input directory for KML files containing sensor locations.
input_dir: "working_files/sensor_locations"

# Default output directory for viewshed results.
output_viewshed_dir: "working_files/viewshed"

# Default output directory for horizon results.
output_horizon_dir: "working_files/horizon"

# Default output directory for detection-range results.
output_detection_dir: "working_files/detection_range"

# Directory for caching downloaded DEM tiles and intermediate data.
cache_dir: "data_cache"

# 'viewshed' command: viewsheds will be calculated for each of these altitudes.
# List of target altitudes in meters.
# Superceded by CLI input if provided.
# Example: [2, 10, 50, 100, 500, 1000, 2000, 10000, 15000]
altitudes_msl_m: [0]

# Reference for target altitudes.
# Options:
#   - "msl": Mean Sea Level (Absolute altitude). Targets below terrain are invisible.
#   - "agl": Above Ground Level (Relative to terrain). Target altitude is added to terrain height.
target_altitude_reference: "agl"

# KML Export Altitude Mode
# Defines how polygons are rendered in Google Earth.
# Options:
#   - "clamped": Polygons are clamped to the ground (terrain). Recommended for best visualization.
#   - "absolute": Polygons are drawn at the calculated target altitude.
#     (Uses 'absolute' for MSL targets, 'relativeToGround' for AGL targets).
kml_export_altitude_mode: "clamped"

# Height of the sensor above ground level (AGL) in meters.
# This is the default value used for all sensors.
# Specify a single value or a comma-separated list to calculate a separate viewshed for each height.
# If an input KML specifies a sensor altitude (using <altitudeMode>relativeToGround</altitudeMode>),
# that value will override this setting for that specific sensor.
# Example: `5.0` or `[2.0, 5.0, 15.0]`
sensor_height_m_agl: 5.0

# Atmospheric refraction factor (k-factor).
# Use 1 for visible line of sight viewsheds.
# For radar calculations in a standard atmosphere 1.333 (4/3 Earth radius) is typical.
atmospheric_k_factor: 1.333

# 'detection-range' command: input viewsheds will be clipped to each of these maximum detection ranges.
# List of maximum detection ranges in kilometres from the sensor location.
# Superceded by CLI input if provided.
# Example: [50, 100, 200]
detection_ranges: [50]

# -----------------------------------------------------------------------------
# Output Settings
# -----------------------------------------------------------------------------

# Tolerance in meters for simplifying the output polygon geometry.
# Higher values result in smaller files but less detailed borders.
simplify_tolerance_m: 5.0

# Output format for the visibility polygons.
# Options: "KML", "KMZ", "GeoJSON"
export_format: "KML"

# Number of decimal places for coordinates in the output.
precision: 9

style:
  # Hex color code for the polygon outline.
  line_color: "#FFA500"
  # Width of the polygon outline in pixels.
  line_width: 2
  # Hex color code for the polygon fill (optional, null for no fill).
  fill_color: "#FFA500"
  # Opacity of the fill (0.0 to 1.0).
  fill_opacity: 0.5

# -----------------------------------------------------------------------------
# Concurrency & Parallel Processing
# -----------------------------------------------------------------------------
concurrency:
  # Execution mode.
  # Options: "process" (recommended for CPU-bound tasks), "thread"
  mode: "process"
  # Maximum number of worker processes/threads.
  max_workers: 18
  # Number of CPUs to leave free for the OS and other tasks.
  reserve_cpus: 4


# Maximum number of threads to use for I/O bound tasks (e.g., downloading).
# Note, Copernicus DEM downloads can be parallelized to improve speed, but free account users are subject to limitations. 
max_threads: 8

# -----------------------------------------------------------------------------
# Resource Management
# -----------------------------------------------------------------------------
resources:
  # Maximum percentage of system RAM to use before swapping to disk or throttling.
  max_ram_percent: 80.0
  # Whether to use disk-backed arrays for large DEMs.
  use_disk_swap: true

# -----------------------------------------------------------------------------
# Progress Reporting
# -----------------------------------------------------------------------------
progress:
  # Enable or disable progress bars in the terminal.
  enabled: true
  # Refresh rate for progress bars in Hz.
  refresh_hz: 10

# -----------------------------------------------------------------------------
# Earth Model Settings
# -----------------------------------------------------------------------------
earth_model:
  # Type of Earth model. Currently only "ellipsoidal" is supported.
  type: "ellipsoidal"
  # Reference ellipsoid.
  ellipsoid: "WGS84"

# Strategy for the Coordinate Reference System (CRS) used for calculations.
# Options:
#   - "auto_aeqd": Automatically use an Azimuthal Equidistant projection centered on each radar (recommended for accuracy).
#   - "manual:EPSG:XXXX": Force a specific EPSG code (e.g., "manual:EPSG:32630").
working_crs_strategy: "auto_aeqd"

# -----------------------------------------------------------------------------
# Vertical Reference Settings
# -----------------------------------------------------------------------------
vertical:
  # Vertical datum for the DEM.
  # Copernicus GLO-30 uses EGM2008.
  dem_vertical_reference: "EGM2008"

# -----------------------------------------------------------------------------
# Multiscale Processing (Level of Detail)
# -----------------------------------------------------------------------------
multiscale:
  # Enable multiscale processing to vary terrain tile resolution with distance for a significant speedup in viewshed processing speed.
  enable: true

  # Heuristically, using multiscale with these settings (30m resolution out to 20km radius, then 90m res beyond) gives 2 to 2.5x speedup with minimal accuracy loss.
  # Distance thresholds (in meters) for switching resolutions.
  near_m: 20000
  mid_m: 100000
  far_m: 800000
  # Resolution (in meters) for each distance zone.
  res_near_m: 30
  res_mid_m: 90
  res_far_m: 90
# Note, Copernicus GLO-30 DEM tiles are available at 30m resolution, so the multiscale 'near' resolution should not be set lower than this.
# When resolution>30 is specified at longer ranges, the GLO-30 DEM tiles will be resampled accordingly (we are not downloading lower resolution data (e.g. GLO-90)).

# -----------------------------------------------------------------------------
# Copernicus Data Space Ecosystem (CDSE) API
# -----------------------------------------------------------------------------
copernicus_api:
  base_url: "https://catalogue.dataspace.copernicus.eu/odata/v1"
  token_url: "https://identity.dataspace.copernicus.eu/auth/realms/CDSE/protocol/openid-connect/token"
  client_id: "cdse-public"
  # Credentials should ideally be supplied via environment variables:
  # COPERNICUS_USERNAME, COPERNICUS_PASSWORD, COPERNICUS_REFRESH_TOKEN
  # You can uncomment and set them here for local testing, but do not commit secrets.
  # username: null
  # password: null
  # refresh_token: null
  
  # Dataset identifier filter.
  dataset_identifier: "COP-DEM_GLO-30"

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------
logging:
  # Logging level. Options: "DEBUG", "INFO", "WARNING", "ERROR"
  level: "INFO"
  # File to write logs to.
  file: "rangeplotter.log"
